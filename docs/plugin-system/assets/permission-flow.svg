<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<svg width="600" height="300" xmlns="http://www.w3.org/2000/svg">
    <style>
        .box {
            fill: white;
            stroke: #2c3e50;
            stroke-width: 2;
        }

        .highlight {
            fill: #ecf0f1;
        }

        .arrow {
            stroke: #2c3e50;
            stroke-width: 2;
            marker-end: url(#arrowhead);
        }

        text {
            font-family: Arial, sans-serif;
            font-size: 14px;
            fill: #2c3e50;
            text-anchor: middle;
        }

        .title {
            font-size: 16px;
            font-weight: bold;
        }

        .subtitle {
            font-size: 12px;
        }
    </style>

    <defs>
        <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
            <polygon points="0 0, 10 3.5, 0 7" fill="#2c3e50" />
        </marker>
    </defs>

    <text x="300" y="30" class="title">Buddy 插件权限流程</text>

    <!-- Boxes -->
    <rect x="50" y="60" width="120" height="60" rx="5" class="box highlight" />
    <text x="110" y="85">安装时显示</text>
    <text x="110" y="105">权限请求</text>

    <rect x="200" y="60" width="120" height="60" rx="5" class="box" />
    <text x="260" y="85">用户审核</text>
    <text x="260" y="105">并授权</text>

    <rect x="350" y="60" width="120" height="60" rx="5" class="box" />
    <text x="410" y="85">存储授权</text>
    <text x="410" y="105">信息</text>

    <rect x="500" y="60" width="120" height="60" rx="5" class="box" />
    <text x="560" y="85">插件运行时</text>
    <text x="560" y="105">权限检查</text>

    <!-- User Interface -->
    <rect x="50" y="170" width="220" height="100" rx="5" class="box" />
    <text x="160" y="190" class="subtitle">权限请求界面</text>
    <line x1="70" y1="200" x2="250" y2="200" stroke="#2c3e50" stroke-width="1" />
    <text x="160" y="220" font-size="12px">插件 "我的插件" 请求以下权限:</text>
    <text x="160" y="240" font-size="12px">- 文件读取权限</text>
    <text x="160" y="255" font-size="12px">- 网络访问权限</text>

    <!-- Runtime Check -->
    <rect x="330" y="170" width="220" height="100" rx="5" class="box" />
    <text x="440" y="190" class="subtitle">运行时权限检查</text>
    <line x1="350" y1="200" x2="530" y2="200" stroke="#2c3e50" stroke-width="1" />
    <text x="440" y="220" font-size="12px">try {</text>
    <text x="440" y="235" font-size="12px"> await buddy.fs.readFile('...')</text>
    <text x="440" y="250" font-size="12px">} catch (e) {</text>
    <text x="440" y="265" font-size="12px"> // 权限检查失败</text>
    <text x="440" y="280" font-size="12px">}</text>

    <!-- Arrows -->
    <line x1="170" y1="90" x2="195" y2="90" class="arrow" />
    <line x1="320" y1="90" x2="345" y2="90" class="arrow" />
    <line x1="470" y1="90" x2="495" y2="90" class="arrow" />

    <line x1="110" y1="120" x2="110" y2="165" class="arrow" />
    <line x1="560" y1="120" x2="560" y2="165" class="arrow" />
    <line x1="440" y1="135" x2="440" y2="165" class="arrow" stroke="#2c3e50" stroke-width="2" stroke-dasharray="5,5"
        marker-end="url(#arrowhead)" />
</svg>
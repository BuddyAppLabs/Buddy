---
title: AI èŠå¤©åŠŸèƒ½
order: 2
---

# AI èŠå¤©åŠŸèƒ½

Buddy å†…ç½®äº† AI èŠå¤©åŠ©æ‰‹ï¼Œé€šè¿‡æœ¬åœ° HTTP API ä¸ AI æœåŠ¡é€šä¿¡ï¼Œæ”¯æŒæµå¼å“åº”ã€‚

## åŠŸèƒ½ç‰¹ç‚¹

- ğŸš€ æµå¼å“åº”ï¼Œå®æ—¶æ˜¾ç¤º AI å›å¤
- ğŸ’¬ æ”¯æŒå¤šè½®å¯¹è¯
- âŒ¨ï¸ å¿«æ·é”®æ”¯æŒ (Cmd+K / Ctrl+K)
- ğŸ¨ ç¾è§‚çš„èŠå¤©ç•Œé¢
- ğŸ”„ æ”¯æŒé‡è¯•å¤±è´¥çš„æ¶ˆæ¯
- ğŸ—‘ï¸ æ¸…ç©ºå¯¹è¯å†å²
- ğŸ”€ æ”¯æŒåˆ‡æ¢ AI ä¾›åº”å•†ï¼ˆOpenAIã€DeepSeekã€Anthropicï¼‰
- ğŸ¤– æ”¯æŒé€‰æ‹©ä¸åŒçš„ AI æ¨¡å‹
- âœ… å‹å¥½çš„æˆåŠŸ/å¤±è´¥æç¤º
- â“ å†…ç½®å¸®åŠ©æŒ‡å—

## ä½¿ç”¨æ–¹å¼

### æ‰“å¼€ AI èŠå¤©

æœ‰ä¸¤ç§æ–¹å¼æ‰“å¼€ AI èŠå¤©é¢æ¿ï¼š

1. **ç‚¹å‡»æŒ‰é’®**: ç‚¹å‡»çŠ¶æ€æ å³ä¾§çš„ "AI" æŒ‰é’®
2. **å¿«æ·é”®**: æŒ‰ä¸‹ `Cmd+K` (macOS) æˆ– `Ctrl+K` (Windows/Linux)

### å‘é€æ¶ˆæ¯

- è¾“å…¥æ¶ˆæ¯åæŒ‰ `Enter` å‘é€
- æŒ‰ `Shift+Enter` æ¢è¡Œ
- ç‚¹å‡»å‘é€æŒ‰é’®å‘é€æ¶ˆæ¯

### å…¶ä»–æ“ä½œ

- **æ¸…ç©ºå¯¹è¯**: ç‚¹å‡»é¡¶éƒ¨çš„åƒåœ¾æ¡¶å›¾æ ‡
- **é‡è¯•**: å¦‚æœæ¶ˆæ¯å‘é€å¤±è´¥ï¼Œç‚¹å‡»"é‡è¯•"æŒ‰é’®
- **å…³é—­é¢æ¿**: ç‚¹å‡»å³ä¸Šè§’çš„å…³é—­æŒ‰é’®æˆ–æŒ‰ `Esc` é”®

## æŠ€æœ¯æ¶æ„

### åç«¯ API

AI æœåŠ¡é€šè¿‡ IPC é€šä¿¡ï¼Œè€Œä¸æ˜¯ HTTP APIã€‚è¿™æ ·æ›´å®‰å…¨ï¼Œä¹Ÿç¬¦åˆ Electron çš„æœ€ä½³å®è·µã€‚

**ä¸»è¦ IPC æ–¹æ³•ï¼š**

```typescript
// å‘é€èŠå¤©æ¶ˆæ¯ï¼ˆæµå¼å“åº”ï¼‰
IPC_METHODS.AI_CHAT_SEND
å‚æ•°: (model: string, messages: UIMessage[])
è¿”å›: { success: boolean, data?: string, error?: string }

// è·å–å¯ç”¨çš„ AI æä¾›å•†
IPC_METHODS.AI_GET_PROVIDERS
è¿”å›: { success: boolean, data?: IProvider[] }

// è·å–å¯ç”¨çš„æ¨¡å‹åˆ—è¡¨
IPC_METHODS.AI_GET_MODELS
è¿”å›: { success: boolean, data?: IModel[] }

// è®¾ç½® API å¯†é’¥
IPC_METHODS.AI_SET_API_KEY
å‚æ•°: (provider: string, key: string)
è¿”å›: { success: boolean }
```

**æµå¼å“åº”äº‹ä»¶ï¼š**

```typescript
// ç›‘å¬æµå¼å“åº”
ipc.receive('ai-chat-stream', (textPart: string) => {
  // å¤„ç†æµå¼æ–‡æœ¬ç‰‡æ®µ
});
```

### å‰ç«¯å®ç°

#### useAIChat Composable

æ ¸å¿ƒçš„èŠå¤©é€»è¾‘å°è£…åœ¨ `useAIChat` composable ä¸­ï¼š

```typescript
import { useAIChat } from '@/ui/composables/useAIChat';

const {
  messages,      // æ¶ˆæ¯åˆ—è¡¨
  input,         // è¾“å…¥æ¡†å†…å®¹
  isLoading,     // åŠ è½½çŠ¶æ€
  error,         // é”™è¯¯ä¿¡æ¯
  sendMessage,   // å‘é€æ¶ˆæ¯
  clearMessages, // æ¸…ç©ºæ¶ˆæ¯
  retry,         // é‡è¯•
} = useAIChat({
  model: 'gpt-4o',
});
```

#### ç»„ä»¶ç»“æ„

```
StatusBar.vue
â”œâ”€â”€ AIChatButton.vue    // AI èŠå¤©æŒ‰é’®
â””â”€â”€ AIChatPanel.vue     // AI èŠå¤©é¢æ¿
    â””â”€â”€ useAIChat.ts    // èŠå¤©é€»è¾‘
```

### æµå¼å“åº”å¤„ç†

ä½¿ç”¨ IPC äº‹ä»¶ç›‘å¬æµå¼å“åº”ï¼š

```typescript
// æ³¨å†Œæµå¼å“åº”ç›‘å¬å™¨
const handleStreamData = (textPart: string) => {
  const lastMessage = messages.value[messages.value.length - 1];
  if (lastMessage && lastMessage.role === 'assistant') {
    lastMessage.content += textPart;
  }
};

ipc.receive('ai-chat-stream', handleStreamData);

// å‘é€æ¶ˆæ¯
const response = await ipc.invoke(
  IPC_METHODS.AI_CHAT_SEND,
  model,
  messages
);

// æ¸…ç†ç›‘å¬å™¨
onUnmounted(() => {
  ipc.removeListener('ai-chat-stream', handleStreamData);
});
```

## é…ç½® AI æ¨¡å‹

### è®¾ç½® API å¯†é’¥

åœ¨ä½¿ç”¨ AI åŠŸèƒ½å‰ï¼Œéœ€è¦é…ç½® API å¯†é’¥ï¼š

```typescript
// é€šè¿‡ IPC è®¾ç½®
const response = await ipc.invoke(
  IPC_METHODS.AI_SET_API_KEY,
  'openai',
  'your-openai-api-key'
);

if (response.success) {
  console.log('API å¯†é’¥è®¾ç½®æˆåŠŸ');
}
```

### æ”¯æŒçš„ AI æä¾›å•†å’Œæ¨¡å‹

#### OpenAI
- GPT-4O
- GPT-4O Mini
- GPT-4 Turbo
- GPT-3.5 Turbo

#### DeepSeek
- DeepSeek Chat
- DeepSeek Coder

#### Anthropic (Claude)
- Claude 3.5 Sonnet
- Claude 3 Opus
- Claude 3 Sonnet

### åˆ‡æ¢ä¾›åº”å•†å’Œæ¨¡å‹

åœ¨èŠå¤©ç•Œé¢åº•éƒ¨ï¼Œå¯ä»¥é€šè¿‡ä¸‹æ‹‰èœå•é€‰æ‹©ï¼š

1. **ä¾›åº”å•†é€‰æ‹©å™¨** - é€‰æ‹© OpenAIã€DeepSeek æˆ– Anthropic
2. **æ¨¡å‹é€‰æ‹©å™¨** - é€‰æ‹©è¯¥ä¾›åº”å•†ä¸‹çš„å…·ä½“æ¨¡å‹

åˆ‡æ¢ä¾›åº”å•†æ—¶ï¼Œä¼šè‡ªåŠ¨é€‰æ‹©è¯¥ä¾›åº”å•†çš„ç¬¬ä¸€ä¸ªæ¨¡å‹ã€‚

**ç¼–ç¨‹æ–¹å¼ï¼š**

```typescript
const {
  selectedProvider,
  selectedModel,
  changeProvider,
  ...
} = useAIChat({
  initialModel: 'gpt-4o',
});

// åˆ‡æ¢ä¾›åº”å•†
changeProvider('deepseek');

// ç›´æ¥è®¾ç½®æ¨¡å‹
selectedModel.value = 'claude-3-5-sonnet-20241022';
```

## è‡ªå®šä¹‰èŠå¤©ç•Œé¢

### ä¿®æ”¹æ ·å¼

èŠå¤©é¢æ¿ä½¿ç”¨ DaisyUI ç»„ä»¶ï¼Œå¯ä»¥é€šè¿‡ä¿®æ”¹ç±»åè‡ªå®šä¹‰æ ·å¼ï¼š

```vue
<!-- ç”¨æˆ·æ¶ˆæ¯ -->
<div class="bg-primary text-primary-content">
  {{ message.content }}
</div>

<!-- AI æ¶ˆæ¯ -->
<div class="bg-base-200 text-base-content">
  {{ message.content }}
</div>
```

### æ·»åŠ è‡ªå®šä¹‰åŠŸèƒ½

å¯ä»¥æ‰©å±• `useAIChat` composable æ·»åŠ æ›´å¤šåŠŸèƒ½ï¼š

```typescript
// æ·»åŠ æ¶ˆæ¯ç¼–è¾‘åŠŸèƒ½
const editMessage = (messageId: string, newContent: string) => {
  const message = messages.value.find(m => m.id === messageId);
  if (message) {
    message.content = newContent;
  }
};

// æ·»åŠ æ¶ˆæ¯åˆ é™¤åŠŸèƒ½
const deleteMessage = (messageId: string) => {
  messages.value = messages.value.filter(m => m.id !== messageId);
};
```

## æœ€ä½³å®è·µ

### é”™è¯¯å¤„ç†

å§‹ç»ˆå¤„ç†å¯èƒ½çš„é”™è¯¯æƒ…å†µï¼š

```typescript
try {
  await sendMessage();
} catch (error) {
  console.error('å‘é€æ¶ˆæ¯å¤±è´¥:', error);
  // æ˜¾ç¤ºé”™è¯¯æç¤º
}
```

### æ€§èƒ½ä¼˜åŒ–

1. **è™šæ‹Ÿæ»šåŠ¨**: å¯¹äºé•¿å¯¹è¯ï¼Œè€ƒè™‘ä½¿ç”¨è™šæ‹Ÿæ»šåŠ¨
2. **æ¶ˆæ¯ç¼“å­˜**: å°†å¯¹è¯å†å²ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
3. **è¯·æ±‚å–æ¶ˆ**: æ”¯æŒå–æ¶ˆæ­£åœ¨è¿›è¡Œçš„è¯·æ±‚

```typescript
const abortController = new AbortController();

fetch(api, {
  signal: abortController.signal,
  // ...
});

// å–æ¶ˆè¯·æ±‚
abortController.abort();
```

### ç”¨æˆ·ä½“éªŒ

1. **åŠ è½½çŠ¶æ€**: æ˜¾ç¤º"æ­£åœ¨æ€è€ƒ..."æç¤º
2. **è‡ªåŠ¨æ»šåŠ¨**: æ–°æ¶ˆæ¯è‡ªåŠ¨æ»šåŠ¨åˆ°åº•éƒ¨
3. **è¾“å…¥æç¤º**: æ˜¾ç¤ºå¿«æ·é”®æç¤º
4. **é”™è¯¯é‡è¯•**: æä¾›é‡è¯•æŒ‰é’®

## æ•…éšœæ’æŸ¥

### IPC é€šä¿¡å¤±è´¥

**é—®é¢˜**: æ— æ³•å‘é€æ¶ˆæ¯æˆ–æ¥æ”¶å“åº”

**è§£å†³æ–¹æ¡ˆ**:
1. æ£€æŸ¥ `AIServiceProvider` æ˜¯å¦æ­£ç¡®å¯åŠ¨
2. ç¡®è®¤ IPC è·¯ç”±å·²æ³¨å†Œï¼ˆ`registerAIRoutes()`ï¼‰
3. æŸ¥çœ‹ä¸»è¿›ç¨‹å’Œæ¸²æŸ“è¿›ç¨‹çš„æ§åˆ¶å°æ—¥å¿—
4. ç¡®è®¤ preload è„šæœ¬æ­£ç¡®åŠ è½½

### API å¯†é’¥æœªé…ç½®

**é—®é¢˜**: è¿”å› 401 æˆ– 403 é”™è¯¯

**è§£å†³æ–¹æ¡ˆ**:
1. é€šè¿‡ API è®¾ç½®æ­£ç¡®çš„ API å¯†é’¥
2. æ£€æŸ¥å¯†é’¥æ˜¯å¦æœ‰æ•ˆ
3. ç¡®è®¤ä½¿ç”¨çš„æ¨¡å‹ä¸å¯†é’¥åŒ¹é…

### æµå¼å“åº”ä¸­æ–­

**é—®é¢˜**: æ¶ˆæ¯æ˜¾ç¤ºä¸å®Œæ•´

**è§£å†³æ–¹æ¡ˆ**:
1. æ£€æŸ¥ç½‘ç»œè¿æ¥
2. å¢åŠ è¶…æ—¶æ—¶é—´
3. æŸ¥çœ‹æœåŠ¡ç«¯æ—¥å¿—

## ç›¸å…³æ–‡ä»¶

- `packages/buddy/src/main/providers/ai/AIServiceProvider.ts` - AI æœåŠ¡æä¾›è€…
- `packages/buddy/src/main/providers/ai/AIManager.ts` - AI ç®¡ç†å™¨
- `packages/buddy/src/main/providers/ai/AIRouter.ts` - API è·¯ç”±
- `packages/buddy/src/ui/components/ai/AIChatPanel.vue` - èŠå¤©é¢æ¿
- `packages/buddy/src/ui/components/ai/AIChatButton.vue` - èŠå¤©æŒ‰é’®
- `packages/buddy/src/ui/composables/useAIChat.ts` - èŠå¤©é€»è¾‘

## å‚è€ƒèµ„æº

- [Vercel AI SDK æ–‡æ¡£](https://sdk.vercel.ai/docs)
- [OpenAI API æ–‡æ¡£](https://platform.openai.com/docs)
- [Anthropic API æ–‡æ¡£](https://docs.anthropic.com/)
